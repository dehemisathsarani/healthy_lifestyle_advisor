<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mental Health Assistant</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f9fafb;
            color: #111827;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }
        header {
            text-align: center;
            margin-bottom: 2rem;
        }
        h1 {
            color: #111827;
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
        }
        p {
            color: #4b5563;
            font-size: 1.1rem;
        }
        .card {
            background-color: white;
            border-radius: 0.75rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            padding: 2rem;
            margin-bottom: 2rem;
        }
        .tabs {
            display: flex;
            justify-content: center;
            gap: 0.5rem;
            margin-bottom: 2rem;
        }
        .tab {
            padding: 0.75rem 1.5rem;
            background-color: #e5e7eb;
            border-radius: 0.5rem;
            cursor: pointer;
            border: none;
            font-weight: 500;
            font-size: 1rem;
        }
        .tab.active {
            background-color: #2563eb;
            color: white;
        }
        .action-buttons {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }
        .btn {
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            border: none;
            font-weight: 500;
            cursor: pointer;
            color: white;
        }
        .btn-green {
            background-color: #10b981;
        }
        .btn-purple {
            background-color: #8b5cf6;
        }
        .result-panel {
            background-color: #ecfdf5;
            border-radius: 0.5rem;
            padding: 1.5rem;
            margin-top: 1.5rem;
        }
        .mood-grid {
            display: flex;
            justify-content: center;
            gap: 1.5rem;
            margin: 1.5rem 0;
            font-size: 2rem;
        }
        .meditation-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 1rem;
            margin-top: 1.5rem;
        }
        .meditation-item {
            border: 1px solid #e5e7eb;
            border-radius: 0.5rem;
            padding: 1rem;
            cursor: pointer;
        }
        .meditation-item:hover {
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üß† Mental Health Assistant</h1>
            <p>Track your mood, practice mindfulness, and enhance your mental wellbeing</p>
        </header>
        
        <div class="card">
            <div class="tabs">
                <button class="tab active">Mood Tracker</button>
                <button class="tab">Wellness Tools</button>
                <button class="tab">Meditation</button>
            </div>
            
            <!-- Mood Tracker Content -->
            <div id="mood-tracker">
                <div style="text-align: center;">
                    <h3 style="font-size: 1.25rem; margin-bottom: 1rem;">How are you feeling today?</h3>
                    <div class="mood-grid">
                        <div>üòä</div>
                        <div>üòê</div>
                        <div>üòî</div>
                        <div>üò°</div>
                        <div>üò∞</div>
                    </div>
                    <p style="color: #4b5563;">Select an emoji to track your mood</p>
                </div>
            </div>
            
            <!-- Wellness Tools Content (hidden by default) -->
            <div id="wellness-tools" style="display: none;">
                <div class="action-buttons">
                    <button class="btn btn-green">Get Grounding Technique</button>
                    <button class="btn btn-purple">Get Gratitude Prompt</button>
                </div>
                
                <div class="result-panel">
                    <h3 style="font-size: 1.25rem; color: #065f46; margin-top: 0;">5-4-3-2-1 Technique</h3>
                    <p style="color: #047857;">Identify 5 things you can see, 4 things you can touch, 3 things you can hear, 2 things you can smell, and 1 thing you can taste.</p>
                    <h4 style="color: #065f46; margin-top: 1rem;">Steps:</h4>
                    <ul style="color: #047857; padding-left: 1.5rem;">
                        <li>Look around and name 5 things you can see</li>
                        <li>Name 4 things you can physically touch or feel</li>
                        <li>Listen carefully and name 3 things you can hear</li>
                        <li>Identify 2 things you can smell (or like to smell)</li>
                        <li>Name 1 thing you can taste (or would like to taste)</li>
                    </ul>
                </div>
            </div>
            
            <!-- Meditation Content (hidden by default) -->
            <div id="meditation" style="display: none;">
                <div style="text-align: center;">
                    <h3 style="font-size: 1.25rem; margin-bottom: 1rem;">Meditation Sessions</h3>
                    <p style="color: #4b5563; margin-bottom: 1.5rem;">Select a meditation to begin your practice</p>
                    
                    <div class="meditation-grid">
                        <div class="meditation-item">
                            <h4 style="margin-top: 0;">Stress Relief</h4>
                            <p style="font-size: 0.875rem; color: #4b5563; margin-bottom: 0;">10 minutes</p>
                        </div>
                        <div class="meditation-item">
                            <h4 style="margin-top: 0;">Focus & Clarity</h4>
                            <p style="font-size: 0.875rem; color: #4b5563; margin-bottom: 0;">15 minutes</p>
                        </div>
                        <div class="meditation-item">
                            <h4 style="margin-top: 0;">Sleep Better</h4>
                            <p style="font-size: 0.875rem; color: #4b5563; margin-bottom: 0;">20 minutes</p>
                        </div>
                        <div class="meditation-item">
                            <h4 style="margin-top: 0;">Quick Calm</h4>
                            <p style="font-size: 0.875rem; color: #4b5563; margin-bottom: 0;">5 minutes</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Tab switching logic
            const tabs = document.querySelectorAll('.tab');
            const tabContents = [
                document.getElementById('mood-tracker'),
                document.getElementById('wellness-tools'),
                document.getElementById('meditation')
            ];
            
            tabs.forEach((tab, index) => {
                tab.addEventListener('click', function() {
                    // Update active tab
                    tabs.forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');
                    
                    // Show corresponding content
                    tabContents.forEach(content => content.style.display = 'none');
                    tabContents[index].style.display = 'block';
                });
            });
            
            // API Base URL
            const API_BASE_URL = 'http://localhost:8002';
            
            // Grounding Technique Button
            const groundingBtn = document.querySelector('.btn-green');
            if (groundingBtn) {
                groundingBtn.addEventListener('click', async function() {
                    try {
                        groundingBtn.textContent = 'Loading...';
                        const response = await fetch(`${API_BASE_URL}/api/mental-health/wellness/grounding-technique`);
                        const data = await response.json();
                        
                        // Update the result panel with grounding technique
                        const resultPanel = document.querySelector('.result-panel');
                        if (resultPanel && data.technique) {
                            resultPanel.innerHTML = `
                                <h3 style="font-size: 1.25rem; color: #065f46; margin-top: 0;">${data.technique.name}</h3>
                                <p style="color: #047857;">${data.technique.description}</p>
                                <h4 style="color: #065f46; margin-top: 1rem;">Steps:</h4>
                                <ul style="color: #047857; padding-left: 1.5rem;">
                                    ${data.technique.steps.map(step => `<li>${step}</li>`).join('')}
                                </ul>
                            `;
                        }
                    } catch (error) {
                        console.error('Error fetching grounding technique:', error);
                    } finally {
                        groundingBtn.textContent = 'Get Grounding Technique';
                    }
                });
            }
            
            // Gratitude Prompt Button
            const gratitudeBtn = document.querySelector('.btn-purple');
            if (gratitudeBtn) {
                gratitudeBtn.addEventListener('click', async function() {
                    try {
                        gratitudeBtn.textContent = 'Loading...';
                        const response = await fetch(`${API_BASE_URL}/api/mental-health/wellness/gratitude-prompt`);
                        const data = await response.json();
                        
                        // Update the result panel with gratitude prompt
                        const resultPanel = document.querySelector('.result-panel');
                        if (resultPanel && data.prompt) {
                            resultPanel.innerHTML = `
                                <h3 style="font-size: 1.25rem; color: #5b21b6; margin-top: 0;">Gratitude Prompt</h3>
                                <p style="color: #6d28d9;">${data.prompt}</p>
                                <div style="margin-top: 1rem; padding: 1rem; background-color: #f5f3ff; border-radius: 0.5rem;">
                                    <h4 style="color: #5b21b6; margin-top: 0;">Reflection Space:</h4>
                                    <textarea style="width: 100%; min-height: 100px; padding: 0.5rem; border: 1px solid #ddd; border-radius: 0.25rem;" placeholder="Write your gratitude reflection here..."></textarea>
                                </div>
                            `;
                        }
                    } catch (error) {
                        console.error('Error fetching gratitude prompt:', error);
                    } finally {
                        gratitudeBtn.textContent = 'Get Gratitude Prompt';
                    }
                });
            }
            
            // Mood tracker emojis
            const moodEmojis = document.querySelectorAll('.mood-grid div');
            if (moodEmojis.length > 0) {
                moodEmojis.forEach((emoji, index) => {
                    emoji.addEventListener('click', async function() {
                        const moodScore = 10 - index * 2; // Convert emoji position to score (10, 8, 6, 4, 2)
                        try {
                            const response = await fetch(`${API_BASE_URL}/api/mental-health/analyze-mood`, {
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/json',
                                },
                                body: JSON.stringify({
                                    mood_score: moodScore,
                                    emotions: [],
                                    recent_activities: [],
                                    sleep_quality: 5
                                }),
                            });
                            
                            const data = await response.json();
                            console.log('Mood tracked:', data);
                            
                            // Show feedback to user
                            const feedbackElement = document.createElement('p');
                            feedbackElement.textContent = 'Mood tracked successfully!';
                            feedbackElement.style.color = '#10b981';
                            feedbackElement.style.textAlign = 'center';
                            feedbackElement.style.marginTop = '1rem';
                            
                            const moodTracker = document.getElementById('mood-tracker');
                            moodTracker.appendChild(feedbackElement);
                            
                            // Remove feedback after 3 seconds
                            setTimeout(() => {
                                moodTracker.removeChild(feedbackElement);
                            }, 3000);
                            
                        } catch (error) {
                            console.error('Error tracking mood:', error);
                        }
                    });
                });
            }
            
            // Meditation items
            const meditationItems = document.querySelectorAll('.meditation-item');
            if (meditationItems.length > 0) {
                meditationItems.forEach((item) => {
                    item.addEventListener('click', async function() {
                        // Extract meditation details from the item
                        const title = item.querySelector('h4').textContent;
                        const duration = parseInt(item.querySelector('p').textContent.split(' ')[0]);
                        
                        // Map title to focus area
                        let focus = 'general';
                        if (title.includes('Stress')) focus = 'stress';
                        if (title.includes('Focus')) focus = 'focus';
                        if (title.includes('Sleep')) focus = 'sleep';
                        if (title.includes('Calm')) focus = 'anxiety';
                        
                        try {
                            const response = await fetch(`${API_BASE_URL}/api/mental-health/meditation/suggest`, {
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/json',
                                },
                                body: JSON.stringify({
                                    duration,
                                    focus,
                                    experience: 'beginner'
                                }),
                            });
                            
                            const data = await response.json();
                            
                            // Create meditation session overlay
                            const overlay = document.createElement('div');
                            overlay.style.position = 'fixed';
                            overlay.style.top = '0';
                            overlay.style.left = '0';
                            overlay.style.width = '100%';
                            overlay.style.height = '100%';
                            overlay.style.backgroundColor = 'rgba(0, 0, 0, 0.8)';
                            overlay.style.display = 'flex';
                            overlay.style.justifyContent = 'center';
                            overlay.style.alignItems = 'center';
                            overlay.style.zIndex = '1000';
                            
                            const content = document.createElement('div');
                            content.style.backgroundColor = 'white';
                            content.style.padding = '2rem';
                            content.style.borderRadius = '0.5rem';
                            content.style.maxWidth = '500px';
                            content.style.width = '90%';
                            
                            content.innerHTML = `
                                <h2 style="text-align: center; margin-top: 0;">${title}</h2>
                                <p style="text-align: center; color: #4b5563;">${duration} minute session</p>
                                <div style="text-align: center; margin: 1.5rem 0;">
                                    <p>${data.suggestion || 'Find a comfortable position. Close your eyes. Focus on your breath.'}</p>
                                </div>
                                <div style="display: flex; justify-content: center;">
                                    <button id="close-meditation" style="padding: 0.75rem 1.5rem; background-color: #4c51bf; color: white; border: none; border-radius: 0.25rem; cursor: pointer;">Close</button>
                                </div>
                            `;
                            
                            overlay.appendChild(content);
                            document.body.appendChild(overlay);
                            
                            // Close button functionality
                            document.getElementById('close-meditation').addEventListener('click', function() {
                                document.body.removeChild(overlay);
                            });
                            
                        } catch (error) {
                            console.error('Error getting meditation suggestion:', error);
                        }
                    });
                });
            }
        });
    </script>
</body>
</html>
